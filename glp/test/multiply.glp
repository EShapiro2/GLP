% multiply.glp - Scalar multiply stream
%
% FUTURE TEST: Requires := arithmetic operator
% From Concurrent Prolog course (handout 5 - Hamming)

% ===== DIRECT EXECUTION =====

% multiply(N, Xs, Ys) :- Ys is Xs with each element multiplied by N
multiply(_, [], []).
multiply(N, [X|Xs], [Y?|Ys?]) :-
  ground(N?) |
  Y := N? * X?,
  multiply(N?, Xs?, Ys).

% ===== METAINTERPRETER =====

run_mult(true).
run_mult((A, B)) :- run_mult(A?), run_mult(B?).
run_mult(A) :- otherwise | reduce_mult(A?, B), run_mult(B?).

% ===== REDUCE CLAUSES =====

% multiply/3
reduce_mult(multiply(_, [], []), true).
reduce_mult(multiply(N, [X|Xs], [Y?|Ys?]),
       (Y := N? * X?,
        multiply(N?, Xs?, Ys))) :-
  ground(N?) | true.

% Handle := in metainterpreter
reduce_mult((X?:=T), true) :- X:=T?.

% ===== TESTS =====
% Direct: multiply(3, [1,2,3,4], Ys) should give Ys = [3,6,9,12]
% Meta:   run_mult(multiply(3, [1,2,3,4], Ys)) should give Ys = [3,6,9,12]
