% factorial.glp - Factorial computation
%
% FUTURE TEST: Requires := arithmetic operator
% From Concurrent Prolog course (solutions3)

% ===== DIRECT EXECUTION =====

% Base cases
factorial(0, 1).
factorial(1, 1).

% Recursive case
factorial(N, F?) :-
  N? > 1 |
  N1 := N? - 1,
  factorial(N1?, F1),
  F := N? * F1?.

% ===== METAINTERPRETER =====

run_fact(true).
run_fact((A, B)) :- run_fact(A?), run_fact(B?).
run_fact(A) :- otherwise | reduce_fact(A?, B), run_fact(B?).

% ===== REDUCE CLAUSES =====

% Base cases
reduce_fact(factorial(0, 1), true).
reduce_fact(factorial(1, 1), true).

% Recursive case
reduce_fact(factorial(N, F?),
       (N1 := N? - 1,
        factorial(N1?, F1),
        F := N? * F1?)) :-
  N? > 1 | true.

% Handle := in metainterpreter
reduce_fact((X?:=T), true) :- X:=T?.

% ===== TESTS =====
% Direct: factorial(5, F) should give F = 120
% Meta:   run_fact(factorial(5, F)) should give F = 120
