% sum_list.glp - Sum elements of a list
%
% FUTURE TEST: Requires := arithmetic operator
% From Concurrent Prolog course (solutions3)

% ===== DIRECT EXECUTION =====
% Args reversed: sum_acc(List, Result, Acc) instead of sum_acc(List, Acc, Result)

% sum(Xs, S) :- S is the sum of elements in Xs
sum(Xs, S?) :- sum_acc(Xs?, S, 0).

sum_acc([], Acc?, Acc).
sum_acc([X|Xs], S?, Acc) :-
  Acc1 := Acc? + X?,
  sum_acc(Xs?, S, Acc1?).

% ===== METAINTERPRETER =====

run_sum(true).
run_sum((A, B)) :- run_sum(A?), run_sum(B?).
run_sum(A) :- otherwise | reduce_sum(A?, B), run_sum(B?).

% ===== REDUCE CLAUSES =====

% sum/2
reduce_sum(sum(Xs, S?), sum_acc(Xs?, S, 0)).

% sum_acc/3 - reversed args
reduce_sum(sum_acc([], Acc?, Acc), true).
reduce_sum(sum_acc([X|Xs], S?, Acc),
       (Acc1 := Acc? + X?,
        sum_acc(Xs?, S, Acc1?))).

% Handle := in metainterpreter
reduce_sum((X?:=T), true) :- X:=T?.

% ===== TESTS =====
% Direct: sum([1,2,3,4,5], S) should give S = 15
% Meta:   run_sum(sum([1,2,3,4,5], S)) should give S = 15
