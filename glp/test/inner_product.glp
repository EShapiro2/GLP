% inner_product.glp - Inner product of two vectors
%
% FUTURE TEST: Requires := arithmetic operator
% From Concurrent Prolog course (solutions3)

% ===== DIRECT EXECUTION =====

% ip(Xs, Ys, S) :- S is the inner product of vectors Xs and Ys
ip(Xs, Ys, S?) :- ip_acc(Xs?, Ys?, 0, S).

ip_acc([], [], Acc, Acc?).
ip_acc([X|Xs], [Y|Ys], Acc, S?) :-
  Acc1 := Acc? + X? * Y?,
  ip_acc(Xs?, Ys?, Acc1?, S).

% ===== METAINTERPRETER =====

run_ip(true).
run_ip((A, B)) :- run_ip(A?), run_ip(B?).
run_ip(A) :- otherwise | reduce_ip(A?, B), run_ip(B?).

% ===== REDUCE CLAUSES =====

% ip/3
reduce_ip(ip(Xs, Ys, S?), ip_acc(Xs?, Ys?, 0, S)).

% ip_acc/4
reduce_ip(ip_acc([], [], Acc, Acc?), true).
reduce_ip(ip_acc([X|Xs], [Y|Ys], Acc, S?),
       (Acc1 := Acc? + X? * Y?,
        ip_acc(Xs?, Ys?, Acc1?, S))).

% Handle := in metainterpreter
reduce_ip((X?:=T), true) :- X:=T?.

% ===== TESTS =====
% Direct: ip([1,2,3], [4,5,6], S) should give S = 32
% Meta:   run_ip(ip([1,2,3], [4,5,6], S)) should give S = 32
