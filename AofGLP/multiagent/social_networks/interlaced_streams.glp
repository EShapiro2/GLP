%% interlaced_streams.glp - Interlaced Streams as Distributed Blocklace
%%
%% Blocklace: DAG where each block references multiple predecessors.
%% Enables concurrent block creation without consensus.

streams(stream(S?), Others) :-
    produce_payloads(Payloads),
    interlace(Payloads?, S, Others?).

produce_payloads([r1, r2]).

interlace([Payload|Payloads], [block(Payload?, Tips?)|Stream?], Others) :-
    collect_tips(Others?, Tips, Others1),
    interlace(Payloads?, Stream, Others1?).
interlace([], [], _).

collect_tips([[Block|Bs]|Others], [Block?|Tips?], [Bs?|Others1?]) :-
    unknown(Bs?) |
    collect_tips(Others?, Tips, Others1).
collect_tips([[_|Bs]|Others], Tips?, [Bs?|Others1?]) :-
    otherwise |
    collect_tips(Others?, Tips, Others1).
collect_tips([], [], []).
