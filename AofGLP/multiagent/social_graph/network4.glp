%% network4.glp - 4-way network switch (partially evaluated)
%% Routes messages between alice, bob, carol, dave based on destination.
%% Message format: msg(Src, Dst, Content)
%% 12 clauses: each of 4 agents can send to 3 others.

%% Alice sends to Bob
network4((alice, ch([msg(Src, bob, Content)|AOut], AIn)), (bob, ch(BOut, [msg(Src?, bob, Content?)|BIn])), (carol, ChC), (dave, ChD)) :-
    network4((alice, ch(AOut?, AIn?)), (bob, ch(BOut?, BIn?)), (carol, ChC?), (dave, ChD?)).

%% Alice sends to Carol
network4((alice, ch([msg(Src, carol, Content)|AOut], AIn)), (bob, ChB), (carol, ch(COut, [msg(Src?, carol, Content?)|CIn])), (dave, ChD)) :-
    network4((alice, ch(AOut?, AIn?)), (bob, ChB?), (carol, ch(COut?, CIn?)), (dave, ChD?)).

%% Alice sends to Dave
network4((alice, ch([msg(Src, dave, Content)|AOut], AIn)), (bob, ChB), (carol, ChC), (dave, ch(DOut, [msg(Src?, dave, Content?)|DIn]))) :-
    network4((alice, ch(AOut?, AIn?)), (bob, ChB?), (carol, ChC?), (dave, ch(DOut?, DIn?))).

%% Bob sends to Alice
network4((alice, ch(AOut, [msg(Src?, alice, Content?)|AIn])), (bob, ch([msg(Src, alice, Content)|BOut], BIn)), (carol, ChC), (dave, ChD)) :-
    network4((alice, ch(AOut?, AIn?)), (bob, ch(BOut?, BIn?)), (carol, ChC?), (dave, ChD?)).

%% Bob sends to Carol
network4((alice, ChA), (bob, ch([msg(Src, carol, Content)|BOut], BIn)), (carol, ch(COut, [msg(Src?, carol, Content?)|CIn])), (dave, ChD)) :-
    network4((alice, ChA?), (bob, ch(BOut?, BIn?)), (carol, ch(COut?, CIn?)), (dave, ChD?)).

%% Bob sends to Dave
network4((alice, ChA), (bob, ch([msg(Src, dave, Content)|BOut], BIn)), (carol, ChC), (dave, ch(DOut, [msg(Src?, dave, Content?)|DIn]))) :-
    network4((alice, ChA?), (bob, ch(BOut?, BIn?)), (carol, ChC?), (dave, ch(DOut?, DIn?))).

%% Carol sends to Alice
network4((alice, ch(AOut, [msg(Src?, alice, Content?)|AIn])), (bob, ChB), (carol, ch([msg(Src, alice, Content)|COut], CIn)), (dave, ChD)) :-
    network4((alice, ch(AOut?, AIn?)), (bob, ChB?), (carol, ch(COut?, CIn?)), (dave, ChD?)).

%% Carol sends to Bob
network4((alice, ChA), (bob, ch(BOut, [msg(Src?, bob, Content?)|BIn])), (carol, ch([msg(Src, bob, Content)|COut], CIn)), (dave, ChD)) :-
    network4((alice, ChA?), (bob, ch(BOut?, BIn?)), (carol, ch(COut?, CIn?)), (dave, ChD?)).

%% Carol sends to Dave
network4((alice, ChA), (bob, ChB), (carol, ch([msg(Src, dave, Content)|COut], CIn)), (dave, ch(DOut, [msg(Src?, dave, Content?)|DIn]))) :-
    network4((alice, ChA?), (bob, ChB?), (carol, ch(COut?, CIn?)), (dave, ch(DOut?, DIn?))).

%% Dave sends to Alice
network4((alice, ch(AOut, [msg(Src?, alice, Content?)|AIn])), (bob, ChB), (carol, ChC), (dave, ch([msg(Src, alice, Content)|DOut], DIn))) :-
    network4((alice, ch(AOut?, AIn?)), (bob, ChB?), (carol, ChC?), (dave, ch(DOut?, DIn?))).

%% Dave sends to Bob
network4((alice, ChA), (bob, ch(BOut, [msg(Src?, bob, Content?)|BIn])), (carol, ChC), (dave, ch([msg(Src, bob, Content)|DOut], DIn))) :-
    network4((alice, ChA?), (bob, ch(BOut?, BIn?)), (carol, ChC?), (dave, ch(DOut?, DIn?))).

%% Dave sends to Carol
network4((alice, ChA), (bob, ChB), (carol, ch(COut, [msg(Src?, carol, Content?)|CIn])), (dave, ch([msg(Src, carol, Content)|DOut], DIn))) :-
    network4((alice, ChA?), (bob, ChB?), (carol, ch(COut?, CIn?)), (dave, ch(DOut?, DIn?))).
